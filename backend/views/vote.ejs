<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
  <script>
    const request = new XMLHttpRequest();
    request.open('GET', 'https://re-wind.today:444/vote/status', true);
    request.send();
    request.onreadystatechange = function(){
      if (request.readyState === 4 && request.status === 200){
        document.getElementById('info').innerHTML = status(JSON.parse(request.responseText).status)
      }
    };
    function disable(){
      const request = new XMLHttpRequest();
      request.open('GET', 'https://re-wind.today:444/vote/status/disable', true);
      request.send();
      request.onreadystatechange = function(){
        if (request.readyState === 4 && request.status === 200){
          document.getElementById('info').innerHTML = '비활성화';
        }
      };
    }
    function enable(){
      const request = new XMLHttpRequest();
      request.open('GET', 'https://re-wind.today:444/vote/status/enable', true);
      request.send();
      request.onreadystatechange = function(){
        if (request.readyState === 4 && request.status === 200){
          document.getElementById('info').innerHTML = '활성화';
        }
      };
    }
    function result(){
      const request = new XMLHttpRequest();
      request.open('GET', 'https://re-wind.today:444/vote/status/result', true);
      request.send();
      request.onreadystatechange = function(){
        if (request.readyState === 4 && request.status === 200){
          document.getElementById('info').innerHTML = '투표 결과 공개';
        }
      };
    }
    function voteRemoveAll(){
      if (confirm('투표 초기화를 진행하시겠습니까?') === true){
        const request = new XMLHttpRequest();
        request.open('GET', 'https://re-wind.today:444/vote/voteremoveall', true);
        request.send();
        request.onreadystatechange = function(){
          if (request.readyState === 4 && request.status === 200){
            document.getElementById('info').innerHTML = '투표 전체 초기화';
          }
        };
      }
    }
    function voteCheck(){
      const request = new XMLHttpRequest();
      request.open('GET', 'https://re-wind.today:444/vote/votegetall', true);
      request.send();
      request.onreadystatechange = function(){
        if (request.readyState === 4 && request.status === 200){
          const data = JSON.parse(request.responseText)
          document.getElementById('vote_1').innerHTML = data.vote_1.length
          document.getElementById('vote_2').innerHTML = data.vote_2.length
          document.getElementById('vote_3').innerHTML = data.vote_3.length
          document.getElementById('vote_4').innerHTML = data.vote_4.length
          document.getElementById('vote_5').innerHTML = data.vote_5.length
          document.getElementById('vote_6').innerHTML = data.vote_6.length
          document.getElementById('vote_7').innerHTML = data.vote_7.length
          document.getElementById('vote_8').innerHTML = data.vote_8.length
          document.getElementById('vote_9').innerHTML = data.vote_9.length
          document.getElementById('vote_count').innerHTML = data.vote_1.length + data.vote_2.length + data.vote_3.length + data.vote_4.length + data.vote_5.length + data.vote_6.length + data.vote_7.length + data.vote_8.length + data.vote_9.length;
        }
      };
    }
    function voteGetAll(){
      const request = new XMLHttpRequest();
      request.open('GET', 'https://re-wind.today:444/vote/votegetall', true);
      request.send();
      request.onreadystatechange = function(){
        if (request.readyState === 4 && request.status === 200){
          document.getElementById('vote').innerHTML = JSON.stringify(JSON.parse(request.responseText), undefined, 2);
        }
      };
    }
    function status(responseText){
      let status = '알 수 없음'
      if (responseText === 'disable'){
        status = '비활성화'
      }
      if (responseText === 'enable'){
        status = '활성화'
      }
      if (responseText === 'result'){
        status = '투표 결과 공개'
      }
      return status
    }
  </script>
  <style>
    @import url(https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@1.0/nanumsquare.css);
    body {
      background: rgb(41, 41, 41);
      color: white;
      font-size:18px;
      font-family:'NanumSquare', sans-serif;
    }
    .btn {
      width: 100%;
      padding: 10px 0;
      color: white;
      border-width: 2px;
      border-style: solid;
      border-color: white;
      margin-top: 10px;
      background-color:transparent;
    }
  </style>
</head>
<body>
  <br/>
  <div class="container">
    <h1>RE-WIND 2022 - 관리자 전용 페이지</h1>
    <br/>
    <br/>
    <h2>실시간 투표 상태: <span id="info"></span></h2>
    <hr/>
    <br/>
    <button type="button" class="btn" style="font-size: large;" onclick="disable()">투표 비활성화 (투표 대기)</button>
    <br/>
    <button type="button" class="btn" style="font-size: large;" onclick="enable()">투표 활성화 (투표 시작)</button>
    <br/>
    <button type="button" class="btn" style="font-size: large;" onclick="result()">투표 결과 공개 (투표 종료)</button>
    <br/>
    <button type="button" class="btn" style="font-size: large; color:red;" onclick="disable(); voteRemoveAll();">투표 전체 초기화 (동점자 발생시)</button>
    <br/>
    <br/>
    <br/>
    <h2>실시간 투표 현황</h2>
    <hr/>
    <br/>
    <br>
    <button type="button" class="btn" style="font-size: large;" onclick="voteCheck()">투표 현황 확인</button>
    <br/>
    <br/>
    <table class="table table-dark">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">팀 이름</th>
          <th scope="col">투표 수</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row">vote_1</th>
          <td>랩으로삼육대를칭칭감지</td>
          <td><span id="vote_1"></span></td>
        </tr>
        <tr>
          <th scope="row">vote_2</th>
          <td>Open your eyes</td>
          <td><span id="vote_2"></span></td>
        </tr>
        <tr>
          <th scope="row">vote_3</th>
          <td>장주안</td>
          <td><span id="vote_3"></span></td>
        </tr>
        <tr>
          <th scope="row">vote_4</th>
          <td>고음불가</td>
          <td><span id="vote_4"></span></td>
        </tr>
        <tr>
          <th scope="row">vote_5</th>
          <td>D.M</td>
          <td><span id="vote_5"></span></td>
        </tr>
        <tr>
          <th scope="row">vote_6</th>
          <td>김주연</td>
          <td><span id="vote_6"></span></td>
        </tr>
        <tr>
          <th scope="row">vote_7</th>
          <td>이성신</td>
          <td><span id="vote_7"></span></td>
        </tr>
        <tr>
          <th scope="row">vote_8</th>
          <td>성시경티</td>
          <td><span id="vote_8"></span></td>
        </tr>
        <tr>
          <th scope="row">vote_9</th>
          <td>PLAGUE</td>
          <td><span id="vote_9"></span></td>
        </tr>
        <tr>
          <th scope="row">합계</th>
          <td></td>
          <td><span id="vote_count"></span></td>
        </tr>
      </tbody>
    </table>
    <br/>
    <br/>
    <br/>
    <h2>RAW DATA</h2>
    <hr/>
    <br/>
    <pre>
      vote_1 -> 랩으로삼육대를칭칭감지
      vote_2 -> Open your eyes
      vote_3 -> 장주안
      vote_4 -> 고음불가
      vote_5 -> D.M
      vote_6 -> 김주연
      vote_7 -> 이성신
      vote_8 -> 성시경티
      vote_9 -> PLAGUE
    </pre>
    <br>
    <button type="button" class="btn" style="font-size: large;" onclick="voteGetAll()">RAW DATA CHECK</button>
    <br/>
    <br/>
    <pre><span id="vote"></span></pre>
  </div>
</body>
</html>
